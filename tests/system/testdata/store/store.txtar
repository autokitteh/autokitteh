# Preconditions: create & build project.
ak project create --name my_project -j
return code == 0
capture_jq pid .project_id

ak project build my_project --file main.py -j
return code == 0
capture_jq bid .build_id

# Set
ak session start --project my_project --build-id $bid --entrypoint main.py:set -j
return code == 0
capture_jq sid .session_id

ak session watch $sid --timeout 5s
return code == 0

# Get
ak session start --project my_project --build-id $bid --entrypoint main.py:get -j
return code == 0
capture_jq sid .session_id

ak session watch $sid --timeout 5s
return code == 0

ak session prints $sid --no-timestamps
return code == 0
output equals meow

# HTTP
http get /store/$pid/cat
output equals meow

-- main.py --
from autokitteh import set_value, get_value, publish_value, unpublish_value

def set(_):
    set_value("cat", "meow")
    publish_value("cat")

def get(_):
    print(get_value("cat"))

def shhh(_):
    unpublish_value("cat")
