ak runtimes build main.star -o main.akb
return code == 0

ak builds upload main.akb
return code == 0
output equals 'build_id: bld_00000000000000000000000001'

ak sessions start --build-id=bld_00000000000000000000000001 --entrypoint main.star
return code == 0
output equals 'session_id: ses_00000000000000000000000002'

ak sessions stop ses_00000000000000000000000002 --force --reason hiss
return code == 0

ak sessions log ses_00000000000000000000000002 -J --no-timestamps --skip -1
return code == 0
output equals_json file force-stop.json

ak sessions start --build-id=bld_00000000000000000000000001 --entrypoint main.star
return code == 0
output equals 'session_id: ses_00000000000000000000000004'

ak sessions watch ses_00000000000000000000000004 -J --no-timestamps --timeout 5s --end-state RUNNING
return code == 0

ak sessions stop ses_00000000000000000000000004 --reason hiss
return code == 0

ak sessions watch ses_00000000000000000000000004 -J --no-timestamps --timeout 15s
return code == 0

ak sessions log ses_00000000000000000000000004 -J --no-timestamps --skip -1
return code == 0
output equals_json file stop.json

-- main.star --
print("Meow, world!")
sleep(10)

-- force-stop.json --
{
  "state": {
    "error": {
      "error": {
        "message": "terminated: hiss"
      }
    }
  }
}

-- stop.json --
{
  "state": {
    "error": {
      "prints": [
        "Meow, world!"
      ],
      "error": {
        "message": "canceled"
      }
    }
  }
}
