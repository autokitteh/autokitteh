# Preconditions: create project and connection.
ak project create my_project
return code == 0
output equals 'project_id: project_00000000000000000000000001'

ak connection create my_connection --project my_project --integration http --connection-token my_url_path
return code == 0
output equals 'connection_id: connection_00000000000000000000000002'

# Negative tests: get nonexistent connection name/ID, with/out --fail flag.
ak connection get my_project/bad_connection
return code == 0
output equals ''

ak connection get connection_deadbeefdeadbeefdeadbeefde
return code == 0
output equals ''

ak connection get my_project/bad_connection --fail
output equals 'Error: connection not found'
return code == 10

ak connection get connection_deadbeefdeadbeefdeadbeefde --fail
output equals 'Error: connection not found'
return code == 10

# Negative test: get connection by name, without project prefix.
ak connection get my_connection
output equals 'Error: invalid connection name "my_connection": missing project prefix'
return code == 1

# Get connection by name/ID, with/out JSON flag.
ak connection get my_project/my_connection
return code == 0
output contains 'connection_id:"connection_00000000000000000000000002"'
output contains 'project_id:"project_00000000000000000000000001"'
output contains 'integration_id:"integration_0000000000f1201a7ed83f7cd5"'
output contains 'integration_token:"my_url_path"'
output contains 'name:"my_connection"'

ak connection get connection_00000000000000000000000002 -J
return code == 0
output equals file expected_connection.json

-- expected_connection.json --
{
  "connection": {
    "connection_id": "connection_00000000000000000000000002",
    "integration_id": "integration_0000000000f1201a7ed83f7cd5",
    "integration_token": "my_url_path",
    "project_id": "project_00000000000000000000000001",
    "name": "my_connection"
  }
}
