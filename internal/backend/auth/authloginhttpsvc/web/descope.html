<!DOCTYPE html>

<html>

<head>
    <script src="/static/descope-web-component.js"></script>
    <script src="/static/descope-web-js-sdk.js"></script>
    <script>
        const projectId = "{{ .ProjectID }}";
        const sdk = Descope({
            projectId: projectId,
            persistTokens: true,
            autoRefresh: true,
            sessionTokenViaCookie: true,
        });

        sdk.refresh();
    </script>
</head>

<body>
    <h1>Descope Login</h1>
    <p id="container" style="max-width: 500px"></p>

    <script>
        const loggedinPath = "/auth/descope/loggedin";

        var container = document.getElementById("container");
        container.innerHTML = `<descope-wc project-id="${projectId}" flow-id="sign-up-or-in"></descope-wc>`;

        const wcElement = document.getElementsByTagName("descope-wc")[0];

        const onSuccess = (e) => {
            window.location.replace(loggedinPath);
        };

        const onError = (err) => console.log(err);

        wcElement.addEventListener("success", onSuccess);
        wcElement.addEventListener("error", onError);
    </script>
</body>

</html>
