!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Descope=t()}(this,(function(){"use strict";const e=(e,t)=>{var n;return["beforeRequest","afterRequest"].reduce(((n,o)=>{var r;return n[o]=[].concat((null===(r=e.hooks)||void 0===r?void 0:r[o])||[]).concat((null==t?void 0:t[o])||[]),n}),null!==(n=e.hooks)&&void 0!==n?n:e.hooks={}),e},t=async e=>{if(!(null==e?void 0:e.ok))return{};const t=await(null==e?void 0:e.clone().json());return(null==t?void 0:t.authInfo)||t||{}},n=async e=>{const n=await t(e);return(null==n?void 0:n.user)||((null==n?void 0:n.hasOwnProperty("userId"))?n:void 0)},o="undefined"!=typeof localStorage,r=(e,t)=>o&&(null===localStorage||void 0===localStorage?void 0:localStorage.setItem(e,t)),i=e=>o&&(null===localStorage||void 0===localStorage?void 0:localStorage.getItem(e)),a=e=>o&&(null===localStorage||void 0===localStorage?void 0:localStorage.removeItem(e));var s=function(){return s=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)};function c(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}function l(e){this.message=e}"function"==typeof SuppressedError&&SuppressedError,l.prototype=new Error,l.prototype.name="InvalidCharacterError";var u="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new l("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,o,r=0,i=0,a="";o=t.charAt(i++);~o&&(n=r%4?64*n+o:o,r++%4)?a+=String.fromCharCode(255&n>>(-2*r&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return a};function d(e){this.message=e}function p(e,t){if("string"!=typeof e)throw new d("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(u(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return u(t)}}(e.split(".")[n]))}catch(e){throw new d("Invalid token specified: "+e.message)}}d.prototype=new Error,d.prototype.name="InvalidTokenError";var g="/v1/auth/accesskey/exchange",h="/v1/auth/otp/verify",f="/v1/auth/otp/signin",v="/v1/auth/otp/signup",w={email:"/v1/auth/otp/update/email",phone:"/v1/auth/otp/update/phone"},m="/v1/auth/otp/signup-in",b="/v1/auth/magiclink/verify",y="/v1/auth/magiclink/signin",I="/v1/auth/magiclink/signup",k={email:"/v1/auth/magiclink/update/email",phone:"/v1/auth/magiclink/update/phone"},O="/v1/auth/magiclink/signup-in",j="/v1/auth/enchantedlink/verify",S="/v1/auth/enchantedlink/signin",U="/v1/auth/enchantedlink/signup",R="/v1/auth/enchantedlink/pending-session",P={email:"/v1/auth/enchantedlink/update/email"},E="/v1/auth/enchantedlink/signup-in",x="/v1/auth/oauth/authorize",T="/v1/auth/oauth/exchange",A="v1/auth/oauth/native/start",C="v1/auth/oauth/native/finish",D="/v1/auth/saml/authorize",q="/v1/auth/saml/exchange",$="/v1/auth/totp/verify",L="/v1/auth/totp/signup",_="/v1/auth/totp/update",J="/v1/auth/notp/whatsapp/signin",N="/v1/auth/notp/whatsapp/signup",K="/v1/auth/notp/whatsapp/signup-in",M="/v1/auth/notp/pending-session",V={start:"/v1/auth/webauthn/signup/start",finish:"/v1/auth/webauthn/signup/finish"},H={start:"/v1/auth/webauthn/signin/start",finish:"/v1/auth/webauthn/signin/finish"},B={start:"/v1/auth/webauthn/signup-in/start"},F={start:"v1/auth/webauthn/update/start",finish:"/v1/auth/webauthn/update/finish"},z="/v1/auth/password/signup",Z="/v1/auth/password/signin",G="/v1/auth/password/reset",X="/v1/auth/password/update",Y="/v1/auth/password/replace",Q="/v1/auth/password/policy",W="/v1/auth/refresh",ee="/v1/auth/tenant/select",te="/v1/auth/logout",ne="/v1/auth/logoutall",oe="/v1/auth/me",re="/v1/auth/me/history",ie="/v1/flow/start",ae="/v1/flow/next";const se="<region>",ce=`https://api.${se}descope.com`,le=6e5,ue=()=>{const e={};return{headers(t){const n="function"==typeof t.entries?Object.fromEntries(t.entries()):t;return e.Headers=JSON.stringify(n),this},body(t){return e.Body=t,this},url(t){return e.Url=t.toString(),this},method(t){return e.Method=t,this},title(t){return e.Title=t,this},status(t){return e.Status=t,this},build:()=>Object.keys(e).flatMap((t=>e[t]?[`${"Title"!==t?`${t}: `:""}${e[t]}`]:[])).join("\n")}};var de;!function(e){e.get="GET",e.delete="DELETE",e.post="POST",e.put="PUT"}(de||(de={}));var pe=429;function ge(e,t,n){var o;let r=he(e);t&&(r=null===(o=null==r?void 0:r.tenants)||void 0===o?void 0:o[t]);const i=null==r?void 0:r[n];return Array.isArray(i)?i:[]}function he(e){if("string"!=typeof e||!e)throw new Error("Invalid token provided");return p(e)}function fe(e){const{exp:t}=he(e);return(new Date).getTime()/1e3>t}function ve(e){let t=he(e);const n=Object.keys(null==t?void 0:t.tenants);return Array.isArray(n)?n:[]}function we(e,t){return ge(e,t,"permissions")}function me(e,t){return ge(e,t,"roles")}const be=(...e)=>e.join("/").replace(/\/{2,}/g,"/");async function ye(e,t){var n;const o=await e,r={code:o.status,ok:o.ok,response:o},i=await o.clone().json();return o.ok?r.data=t?t(i):i:(r.error=i,o.status===pe&&Object.assign(r.error,{retryAfter:Number.parseInt(null===(n=o.headers)||void 0===n?void 0:n.get("retry-after"))||0})),r}const Ie=(...e)=>new Headers(e.reduce(((e,t)=>{const n=(e=>Array.isArray(e)?e:e instanceof Headers?Array.from(e.entries()):e?Object.entries(e):[])(t);return n.reduce(((t,[n,o])=>(e[n]=o,e)),e),e}),{})),ke=e=>void 0===e?void 0:JSON.stringify(e),Oe=(e,t="")=>{let n=e;return t&&(n=n+":"+t),{Authorization:`Bearer ${n}`}},je=({baseUrl:e,projectId:t,baseConfig:n,logger:o,hooks:r,cookiePolicy:i,fetch:a})=>{const s=((e,t)=>{const n=(e=>async(...t)=>{const n=await e(...t),o=await n.text();return n.text=()=>Promise.resolve(o),n.json=()=>Promise.resolve(JSON.parse(o)),n.clone=()=>n,n})(t||fetch);return n||null==e||e.warn("Fetch is not defined, you will not be able to send http requests, if you are running in a test, make sure fetch is defined globally"),e?async(...t)=>{if(!n)throw Error("Cannot send http request, fetch is not defined, if you are running in a test, make sure fetch is defined globally");e.log((e=>ue().title("Request").url(e[0]).method(e[1].method).headers(e[1].headers).body(e[1].body).build())(t));const o=await n(...t);return e[o.ok?"log":"error"](await(async e=>{const t=await e.text();return ue().title("Response").url(e.url.toString()).status(`${e.status} ${e.statusText}`).headers(e.headers).body(t).build()})(o)),o}:n})(o,a),c=async o=>{const a=(null==r?void 0:r.beforeRequest)?r.beforeRequest(o):o,{path:c,body:l,headers:u,queryParams:d,method:p,token:g}=a,h={headers:Ie(Oe(t,g),{"x-descope-sdk-name":"core-js","x-descope-sdk-version":"2.14.6"},(null==n?void 0:n.baseHeaders)||{},u),method:p,body:ke(l)};null!==i&&(h.credentials=i||"include");const f=await s((({path:e,baseUrl:t,queryParams:n,projectId:o})=>{const r=o.slice(1,-27);t=t.replace(se,r?r+".":"");const i=new URL(t);return i.pathname=be(i.pathname,e),n&&(i.search=new URLSearchParams(n).toString()),i})({path:c,baseUrl:e,queryParams:d,projectId:t}),h);return(null==r?void 0:r.afterRequest)&&await r.afterRequest(o,null==f?void 0:f.clone()),f};return{get:(e,{headers:t,queryParams:n,token:o}={})=>c({path:e,headers:t,queryParams:n,body:void 0,method:de.get,token:o}),post:(e,t,{headers:n,queryParams:o,token:r}={})=>c({path:e,headers:n,queryParams:o,body:t,method:de.post,token:r}),put:(e,t,{headers:n,queryParams:o,token:r}={})=>c({path:e,headers:n,queryParams:o,body:t,method:de.put,token:r}),delete:(e,{headers:t,queryParams:n,token:o}={})=>c({path:e,headers:t,queryParams:n,body:void 0,method:de.delete,token:o}),hooks:r}},Se=(e,t)=>(n=t)=>t=>!e(t)&&n.replace("{val}",t),Ue=(...e)=>({validate:t=>(e.forEach((e=>{const n=e(t);if(n)throw new Error(n)})),!0)}),Re=e=>t=>e.test(t),Pe=Re(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/),Ee=Re(/^\+[1-9]{1}[0-9]{3,14}$/),xe=Se(Pe,'"{val}" is not a valid email'),Te=Se(Ee,'"{val}" is not a valid phone number'),Ae=Se((1,e=>e.length>=1),"Minimum length is 1");const Ce=Se((e=>"string"==typeof e),"Input is not a string"),De=Se((e=>void 0===e),"Input is defined"),qe=($e=[Ce(),De()],"Input is not a string or undefined",(e="Input is not a string or undefined")=>t=>{const n=$e.filter((e=>e(t)));return!(n.length<$e.length)&&(e?e.replace("{val}",t):n.join(" OR "))});var $e;const Le=(...e)=>t=>(...n)=>(e.forEach(((e,t)=>Ue(...e).validate(n[t]))),t(...n)),_e=e=>[Ce(`"${e}" must be a string`)],Je=e=>[Ce(`"${e}" must be a string`),Ae(`"${e}" must not be empty`)],Ne=e=>[Ce(`"${e}" must be a string`),xe()],Ke=e=>[Ce(`"${e}" must be a string`),Te()],Me=Le(Je("accessKey")),Ve=e=>({exchange:Me(((t,n)=>ye(e.post(g,{loginOptions:n},{token:t}))))}),He=(e,t,n)=>(t.forEach((t=>{const o=t.split(".");let r=o.shift(),i=e;for(;o.length>0;){if(i=i[r],!r||!i)throw Error(`Invalid path "${t}", "${r}" is missing or has no value`);r=o.shift()}if("function"!=typeof i[r])throw Error(`"${t}" is not a function`);const a=i[r];i[r]=n(a)})),e),Be=({pollingIntervalMs:e=1e3,timeoutMs:t=6e5}={})=>({pollingIntervalMs:Math.max(e||1e3,1e3),timeoutMs:Math.min(t||le,le)});var Fe,ze;!function(e){e.sms="sms",e.voice="voice",e.whatsapp="whatsapp"}(Fe||(Fe={})),function(e){e.email="email"}(ze||(ze={}));const Ze=Object.assign(Object.assign({},Fe),ze);var Ge;!function(e){e.waiting="waiting",e.running="running",e.completed="completed",e.failed="failed"}(Ge||(Ge={}));const Xe=Je("loginId"),Ye=Le(Je("token")),Qe=Le(Xe),We=Le(Je("pendingRef")),et=Le(Xe,Ne("email")),tt=e=>({verify:Ye((t=>ye(e.post(j,{token:t})))),signIn:Qe(((t,n,o,r)=>ye(e.post(be(S,Ze.email),{loginId:t,URI:n,loginOptions:o},{token:r})))),signUpOrIn:Qe(((t,n,o)=>ye(e.post(be(E,Ze.email),{loginId:t,URI:n,loginOptions:o})))),signUp:Qe(((t,n,o,r)=>ye(e.post(be(U,Ze.email),{loginId:t,URI:n,user:o,loginOptions:r})))),waitForSession:We(((t,n)=>new Promise((o=>{const{pollingIntervalMs:r,timeoutMs:i}=Be(n);let a;const s=setInterval((async()=>{const n=await e.post(R,{pendingRef:t});n.ok&&(clearInterval(s),a&&clearTimeout(a),o(ye(Promise.resolve(n))))}),r);a=setTimeout((()=>{o({error:{errorDescription:`Session polling timeout exceeded: ${i}ms`,errorCode:"0"},ok:!1}),clearInterval(s)}),i)})))),update:{email:et(((t,n,o,r,i)=>ye(e.post(P.email,Object.assign({loginId:t,email:n,URI:o},i),{token:r}))))}}),nt=Le(Je("flowId")),ot=Le(Je("executionId"),Je("stepId"),Je("interactionId")),rt=e=>({start:nt(((t,n,o,r,i,a,s)=>ye(e.post(ie,{flowId:t,options:n,conditionInteractionId:o,interactionId:r,version:i,componentsVersion:a,input:s})))),next:ot(((t,n,o,r,i,a)=>ye(e.post(ae,{executionId:t,stepId:n,interactionId:o,version:r,componentsVersion:i,input:a}))))}),it=Je("loginId"),at=Le(Je("token")),st=Le(it),ct=Le(it,Ke("phone")),lt=Le(it,Ne("email")),ut=Object.keys(Ze).filter((e=>e!==Fe.voice)),dt=e=>({verify:at((t=>ye(e.post(b,{token:t})))),signIn:ut.reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:st(((t,o,r,i)=>ye(e.post(be(y,n),{loginId:t,URI:o,loginOptions:r},{token:i}))))})),{}),signUp:ut.reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:st(((t,o,r,i)=>ye(e.post(be(I,n),{loginId:t,URI:o,user:r,loginOptions:i}))))})),{}),signUpOrIn:ut.reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:st(((t,o,r)=>ye(e.post(be(O,n),{loginId:t,URI:o,loginOptions:r}))))})),{}),update:{email:lt(((t,n,o,r,i)=>ye(e.post(k.email,Object.assign({loginId:t,email:n,URI:o},i),{token:r})))),phone:Object.keys(Fe).filter((e=>e!==Fe.voice)).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:ct(((t,o,r,i,a)=>ye(e.post(be(k.phone,n),Object.assign({loginId:t,phone:o,URI:r},a),{token:i}))))})),{})}});var pt;!function(e){e.facebook="facebook",e.github="github",e.google="google",e.microsoft="microsoft",e.gitlab="gitlab",e.apple="apple",e.discord="discord",e.linkedin="linkedin",e.slack="slack"}(pt||(pt={}));const gt=Le(Je("code")),ht=e=>({start:Object.assign(((t,n,o,r)=>ye(e.post(x,o||{},{queryParams:Object.assign({provider:t},n&&{redirectURL:n}),token:r}))),Object.keys(pt).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:(t,o,r)=>ye(e.post(x,o||{},{queryParams:Object.assign({provider:n},t&&{redirectURL:t}),token:r}))})),{})),exchange:gt((t=>ye(e.post(T,{code:t})))),startNative:(t,n)=>ye(e.post(A,{provider:t,loginOptions:n})),finishNative:(t,n,o,r,i)=>ye(e.post(C,{provider:t,stateId:n,user:o,code:r,idToken:i}))}),ft=Je("loginId"),vt=Le(ft,Je("code")),wt=Le(ft),mt=Le(ft,Ke("phone")),bt=Le(ft,Ne("email")),yt=e=>({verify:Object.keys(Ze).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:vt(((t,o)=>ye(e.post(be(h,n),{code:o,loginId:t}))))})),{}),signIn:Object.keys(Ze).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:wt(((t,o,r)=>ye(e.post(be(f,n),{loginId:t,loginOptions:o},{token:r}))))})),{}),signUp:Object.keys(Ze).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:wt(((t,o,r)=>ye(e.post(be(v,n),{loginId:t,user:o,loginOptions:r}))))})),{}),signUpOrIn:Object.keys(Ze).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:wt(((t,o)=>ye(e.post(be(m,n),{loginId:t,loginOptions:o}))))})),{}),update:{email:bt(((t,n,o,r)=>ye(e.post(w.email,Object.assign({loginId:t,email:n},r),{token:o})))),phone:Object.keys(Fe).reduce(((t,n)=>Object.assign(Object.assign({},t),{[n]:mt(((t,o,r,i)=>ye(e.post(be(w.phone,n),Object.assign({loginId:t,phone:o},i),{token:r}))))})),{})}}),It=Le(Je("tenant")),kt=Le(Je("code")),Ot=e=>({start:It(((t,n,o,r)=>ye(e.post(D,o||{},{queryParams:{tenant:t,redirectURL:n},token:r})))),exchange:kt((t=>ye(e.post(q,{code:t}))))}),jt=Je("loginId"),St=Le(jt,Je("code")),Ut=Le(jt),Rt=Le(jt),Pt=e=>({signUp:Ut(((t,n)=>ye(e.post(L,{loginId:t,user:n})))),verify:St(((t,n,o,r)=>ye(e.post($,{loginId:t,code:n,loginOptions:o},{token:r})))),update:Rt(((t,n)=>ye(e.post(_,{loginId:t},{token:n}))))}),Et=Je("loginId"),xt=Je("newPassword"),Tt=Le(Et,Je("password")),At=Le(Et),Ct=Le(Et,xt),Dt=Le(Et,Je("oldPassword"),xt),qt=e=>({signUp:Tt(((t,n,o)=>ye(e.post(z,{loginId:t,password:n,user:o})))),signIn:Tt(((t,n)=>ye(e.post(Z,{loginId:t,password:n})))),sendReset:At(((t,n,o)=>ye(e.post(G,{loginId:t,redirectUrl:n,templateOptions:o})))),update:Ct(((t,n,o)=>ye(e.post(X,{loginId:t,newPassword:n},{token:o})))),replace:Dt(((t,n,o)=>ye(e.post(Y,{loginId:t,oldPassword:n,newPassword:o})))),policy:()=>ye(e.get(Q))}),$t=_e("loginId"),Lt=Je("loginId"),_t=Je("origin"),Jt=Le(Lt,_t,Je("name")),Nt=Le(Lt,_t),Kt=Le($t,_t),Mt=Le(Lt,_t,Je("token")),Vt=Le(Je("transactionId"),Je("response")),Ht=e=>({signUp:{start:Jt(((t,n,o)=>ye(e.post(V.start,{user:{loginId:t,name:o},origin:n})))),finish:Vt(((t,n)=>ye(e.post(V.finish,{transactionId:t,response:n}))))},signIn:{start:Kt(((t,n,o,r)=>ye(e.post(H.start,{loginId:t,origin:n,loginOptions:o},{token:r})))),finish:Vt(((t,n)=>ye(e.post(H.finish,{transactionId:t,response:n}))))},signUpOrIn:{start:Nt(((t,n)=>ye(e.post(B.start,{loginId:t,origin:n}))))},update:{start:Mt(((t,n,o)=>ye(e.post(F.start,{loginId:t,origin:n},{token:o})))),finish:Vt(((t,n)=>ye(e.post(F.finish,{transactionId:t,response:n}))))}}),Bt=_e("loginId"),Ft=Le(Bt),zt=Le(Je("pendingRef")),Zt=e=>({signUpOrIn:Ft(((t,n)=>ye(e.post(K,{loginId:t,loginOptions:n})))),signUp:Ft(((t,n,o)=>ye(e.post(N,{loginId:t,user:n,loginOptions:o})))),signIn:Ft(((t,n,o)=>ye(e.post(J,{loginId:t,loginOptions:n},{token:o})))),waitForSession:zt(((t,n)=>new Promise((o=>{const{pollingIntervalMs:r,timeoutMs:i}=Be(n);let a;const s=setInterval((async()=>{const n=await e.post(M,{pendingRef:t});n.ok&&(clearInterval(s),a&&clearTimeout(a),o(ye(Promise.resolve(n))))}),r);a=setTimeout((()=>{o({error:{errorDescription:`Session polling timeout exceeded: ${i}ms`,errorCode:"0"},ok:!1}),clearInterval(s)}),i)}))))}),Gt=Le(Je("token")),Xt=Le([qe('"token" must be string or undefined')]);var Yt,Qt=Le([("projectId",Yt=Je("projectId"),Se(((e,t)=>n=>Ue(...t).validate(((e,t,n)=>{const o=(Array.isArray(t)?t.join("."):String(t)).replace(/\[\\?("|')?(\w|d)+\\?("|')?\]/g,((e,t,n)=>"."+n)).split("."),r=o.length;let i=0,a=e===Object(e)?e:void 0;for(;null!=a&&i<r;)a=a[o[i++]];return i&&i===r&&void 0!==a?a:void 0})(n,e)))("projectId",Yt))())])((e=>(({projectId:e,logger:t,baseUrl:n,hooks:o,cookiePolicy:r,baseHeaders:i={},fetch:a})=>{return s=je({baseUrl:n||ce,projectId:e,logger:t,hooks:o,cookiePolicy:r,baseConfig:{baseHeaders:i},fetch:a}),{accessKey:Ve(s),otp:yt(s),magicLink:dt(s),enchantedLink:tt(s),oauth:ht(s),saml:Ot(s),totp:Pt(s),notp:Zt(s),webauthn:Ht(s),password:qt(s),flow:rt(s),refresh:Xt((e=>ye(s.post(W,{},{token:e})))),selectTenant:Le([Ce("tenantId")],[qe('"token" must be string or undefined')])(((e,t)=>ye(s.post(ee,{tenant:e},{token:t})))),logout:Xt((e=>ye(s.post(te,{},{token:e})))),logoutAll:Xt((e=>ye(s.post(ne,{},{token:e})))),me:Xt((e=>ye(s.get(oe,{token:e})))),history:Xt((e=>ye(s.get(re,{token:e})))),isJwtExpired:Gt(fe),getTenants:Gt(ve),getJwtPermissions:Gt(we),getJwtRoles:Gt(me),httpClient:s};var s})(Object.assign(Object.assign({},e),{hooks:{beforeRequest:t=>{var n;const o=[].concat((null===(n=e.hooks)||void 0===n?void 0:n.beforeRequest)||[]);return null==o?void 0:o.reduce(((e,t)=>t(e)),t)},afterRequest:async(t,n)=>{var o;const r=[].concat((null===(o=e.hooks)||void 0===o?void 0:o.afterRequest)||[]);(await Promise.allSettled(null==r?void 0:r.map((e=>e(t,null==n?void 0:n.clone()))))).forEach((t=>{var n;return"rejected"===t.status&&(null===(n=e.logger)||void 0===n?void 0:n.error(t.reason))}))}}})))),Wt=Object.assign(Qt,{DeliveryMethods:Ze});const en=(...e)=>{console.debug(...e)},tn="undefined"!=typeof window,nn=Math.pow(2,31)-1,on=tn&&(null===localStorage||void 0===localStorage?void 0:localStorage.getItem("fingerprint.endpoint.url"))||"https://api.descope.com";var rn={default:"endpoint"},an="Blocked by CSP",sn="The endpoint parameter is not a valid URL",cn="Failed to load the JS script of the agent",ln="9319";function un(e,t){var n,o,r,i,a=[],s=(n=function(e){var t=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}([],e,!0);return{current:function(){return t[0]},postpone:function(){var e=t.shift();void 0!==e&&t.push(e)},exclude:function(){t.shift()}}}(e),100,3e3,i=0,o=function(){return Math.random()*Math.min(3e3,100*Math.pow(2,i++))},r=new Set,[n.current(),function(e,t){var i,a=t instanceof Error?t.message:"";if(a===an||a===sn)n.exclude(),i=0;else if(a===ln)n.exclude();else if(a===cn){var s=Date.now()-e.getTime()<50,c=n.current();c&&s&&!r.has(c)&&(r.add(c),i=0),n.postpone()}else n.postpone();var l=n.current();return void 0===l?void 0:[l,null!=i?i:e.getTime()+o()-Date.now()]}]),c=s[0],l=s[1];if(void 0===c)return Promise.reject(new TypeError("The list of script URL patterns is empty"));var u=function(e){var n=new Date,o=function(t){return a.push({url:e,startedAt:n,finishedAt:new Date,error:t})},r=t(e);return r.then((function(){return o()}),o),r.catch((function(e){if(a.length>=5)throw e;var t=l(n,e);if(!t)throw e;var o,r=t[0],i=t[1];return(o=i,new Promise((function(e){return setTimeout(e,o)}))).then((function(){return u(r)}))}))};return u(c).then((function(e){return[e,a]}))}var dn="https://fpnpmcdn.net/v<version>/<apiKey>/loader_v<loaderVersion>.js",pn=dn;function gn(e){var t;e.scriptUrlPattern;var n=e.token,o=e.apiKey,r=void 0===o?n:o,i=c(e,["scriptUrlPattern","token","apiKey"]),a=null!==(t=function(e,t){return function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(e,t)?e[t]:void 0}(e,"scriptUrlPattern"))&&void 0!==t?t:dn,l=function(){var e=[],t=function(){e.push({time:new Date,state:document.visibilityState})},n=function(e,t,n,o){return e.addEventListener(t,n,o),function(){return e.removeEventListener(t,n,o)}}(document,"visibilitychange",t);return t(),[e,n]}(),u=l[0],d=l[1];return Promise.resolve().then((function(){if(!r||"string"!=typeof r)throw new Error("API key required");var e=function(e,t){return(Array.isArray(e)?e:[e]).map((function(e){return function(e,t){var n=encodeURIComponent;return e.replace(/<[^<>]+>/g,(function(e){return"<version>"===e?"3":"<apiKey>"===e?n(t):"<loaderVersion>"===e?n("3.9.3"):e}))}(String(e),t)}))}(a,r);return un(e,hn)})).catch((function(e){throw d(),function(e){return e instanceof Error&&e.message===ln?new Error(cn):e}(e)})).then((function(e){var t=e[0],n=e[1];return d(),t.load(s(s({},i),{ldi:{attempts:n,visibilityStates:u}}))}))}function hn(e){return function(e,t,n,o){var r,i=document,a="securitypolicyviolation",s=function(t){var n=new URL(e,location.href),o=t.blockedURI;o!==n.href&&o!==n.protocol.slice(0,-1)&&o!==n.origin||(r=t,c())};i.addEventListener(a,s);var c=function(){return i.removeEventListener(a,s)};return Promise.resolve().then(t).then((function(e){return c(),e}),(function(e){return new Promise((function(e){return setTimeout(e)})).then((function(){if(c(),r)return function(){throw new Error(an)}();throw e}))}))}(e,(function(){return function(e){return new Promise((function(t,n){if(function(e){if(URL.prototype)try{return new URL(e,location.href),!1}catch(e){if(e instanceof Error&&"TypeError"===e.name)return!0;throw e}}(e))throw new Error(sn);var o=document.createElement("script"),r=function(){var e;return null===(e=o.parentNode)||void 0===e?void 0:e.removeChild(o)},i=document.head||document.getElementsByTagName("head")[0];o.onload=function(){r(),t()},o.onerror=function(){r(),n(new Error(cn))},o.async=!0,o.src=e,i.appendChild(o)}))}(e)})).then(fn)}function fn(){var e=window,t="__fpjs_p_l_b",n=e[t];if(function(e,t){var n,o=null===(n=Object.getOwnPropertyDescriptor)||void 0===n?void 0:n.call(Object,e,t);(null==o?void 0:o.configurable)?delete e[t]:o&&!o.writable||(e[t]=void 0)}(e,t),"function"!=typeof(null==n?void 0:n.load))throw new Error(ln);return n}const vn=(e=!1)=>{const t=localStorage.getItem("fp");if(!t)return null;const n=JSON.parse(t);return(new Date).getTime()>n.expiry&&!e?null:n.value},wn=async(e,t=on)=>{try{if(vn())return;const n=(Date.now().toString(36)+Math.random().toString(36).substring(2)+Math.random().toString(36).substring(2)).substring(0,27),o=new URL(t);o.pathname="/fXj8gt3x8VulJBna/x96Emn69oZwcd7I6";const r=new URL(t);r.pathname="/fXj8gt3x8VulJBna/w78aRZnnDZ3Aqw0I";const i=r.toString()+"?apiKey=<apiKey>&version=<version>&loaderVersion=<loaderVersion>",a=gn({apiKey:e,endpoint:[o.toString(),rn],scriptUrlPattern:[i,pn]}),s=await a,{requestId:c}=await s.get({linkedId:n}),l=((e,t)=>({vsid:e,vrid:t}))(n,c);(e=>{const t={value:e,expiry:(new Date).getTime()+864e5};localStorage.setItem("fp",JSON.stringify(t))})(l)}catch(e){console.warn("Could not load fingerprint",e)}},mn=e=>{const t=vn(!0);return t&&e.body&&(e.body.fpData=t),e},bn="dls_last_user_login_id",yn="dls_last_user_display_name",In=()=>i(bn),kn=()=>i(yn),On=e=>async(...t)=>{var n;t[1]=t[1]||{};const[,o={}]=t,r=In(),i=kn();r&&(null!==(n=o.lastAuth)&&void 0!==n||(o.lastAuth={}),o.lastAuth.loginId=r,o.lastAuth.name=i);return await e(...t)},jn=e=>async(...t)=>{const n=await e(...t);return a(bn),a(yn),n};function Sn(){const e=[];return{pub:t=>{e.forEach((e=>e(t)))},sub:t=>{const n=e.push(t)-1;return()=>e.splice(n,1)}}}
/*! js-cookie v3.0.5 | MIT */
function Un(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)e[o]=n[o]}return e}var Rn=function e(t,n){function o(e,o,r){if("undefined"!=typeof document){"number"==typeof(r=Un({},n,r)).expires&&(r.expires=new Date(Date.now()+864e5*r.expires)),r.expires&&(r.expires=r.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var a in r)r[a]&&(i+="; "+a,!0!==r[a]&&(i+="="+r[a].split(";")[0]));return document.cookie=e+"="+t.write(o,e)+i}}return Object.create({set:o,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],o={},r=0;r<n.length;r++){var i=n[r].split("="),a=i.slice(1).join("=");try{var s=decodeURIComponent(i[0]);if(o[s]=t.read(a,s),e===s)break}catch(e){}}return e?o[e]:o}},remove:function(e,t){o(e,"",Un({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,Un({},this.attributes,t))},withConverter:function(t){return e(Un({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});const Pn="DS",En="DSR";function xn(e,t,{cookiePath:n,cookieDomain:o,cookieExpiration:r}){if(t){const i=new Date(1e3*r),a=function(e){const t=window.location.hostname.split("."),n=e.split(".");return t.slice(-n.length).join(".")===e}(o);Rn.set(e,t,{path:n,domain:a?o:void 0,expires:i,sameSite:"Strict",secure:!0})}}function Tn(e=""){return i(`${e}${En}`)||""}function An(e=""){a(`${e}${En}`),a(`${e}${Pn}`),Rn.remove(Pn)}const Cn=e=>t=>async(...n)=>{const o=await t(...n);return An(e),o};async function Dn(e){const t=function(e){var t;const n=JSON.parse(e);return n.publicKey.challenge=Nn(n.publicKey.challenge),n.publicKey.user.id=Nn(n.publicKey.user.id),null===(t=n.publicKey.excludeCredentials)||void 0===t||t.forEach((e=>{e.id=Nn(e.id)})),n}(e),n=await navigator.credentials.create(t);return o=n,JSON.stringify({id:o.id,rawId:Kn(o.rawId),type:o.type,response:{attestationObject:Kn(o.response.attestationObject),clientDataJSON:Kn(o.response.clientDataJSON)}});var o}async function qn(e){const t=_n(e);return Jn(await navigator.credentials.get(t))}async function $n(e,t){const n=_n(e);n.signal=t.signal,n.mediation="conditional";return Jn(await navigator.credentials.get(n))}async function Ln(e=!1){if(!tn)return Promise.resolve(!1);const t=!!(window.PublicKeyCredential&&navigator.credentials&&navigator.credentials.create&&navigator.credentials.get);return t&&e&&PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():t}function _n(e){var t;const n=JSON.parse(e);return n.publicKey.challenge=Nn(n.publicKey.challenge),null===(t=n.publicKey.allowCredentials)||void 0===t||t.forEach((e=>{e.id=Nn(e.id)})),n}function Jn(e){return JSON.stringify({id:e.id,rawId:Kn(e.rawId),type:e.type,response:{authenticatorData:Kn(e.response.authenticatorData),clientDataJSON:Kn(e.response.clientDataJSON),signature:Kn(e.response.signature),userHandle:e.response.userHandle?Kn(e.response.userHandle):void 0}})}function Nn(e){const t=e.replace(/_/g,"/").replace(/-/g,"+");return Uint8Array.from(atob(t),(e=>e.charCodeAt(0))).buffer}function Kn(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}var Mn,Vn=(Mn=e=>({async signUp(t,n){const o=await e.webauthn.signUp.start(t,window.location.origin,n);if(!o.ok)return o;const r=await Dn(o.data.options);return await e.webauthn.signUp.finish(o.data.transactionId,r)},async signIn(t){const n=await e.webauthn.signIn.start(t,window.location.origin);if(!n.ok)return n;const o=await qn(n.data.options);return await e.webauthn.signIn.finish(n.data.transactionId,o)},async signUpOrIn(t){var n;const o=await e.webauthn.signUpOrIn.start(t,window.location.origin);if(!o.ok)return o;if(null===(n=o.data)||void 0===n?void 0:n.create){const t=await Dn(o.data.options);return await e.webauthn.signUp.finish(o.data.transactionId,t)}{const t=await qn(o.data.options);return await e.webauthn.signIn.finish(o.data.transactionId,t)}},async update(t,n){const o=await e.webauthn.update.start(t,window.location.origin,n);if(!o.ok)return o;const r=await Dn(o.data.options);return await e.webauthn.update.finish(o.data.transactionId,r)},helpers:{create:Dn,get:qn,isSupported:Ln,conditional:$n}}),(...e)=>{const t=Mn(...e);return Object.assign(t.signUp,e[0].webauthn.signUp),Object.assign(t.signIn,e[0].webauthn.signIn),Object.assign(t.signUpOrIn,e[0].webauthn.signUpOrIn),Object.assign(t.update,e[0].webauthn.update),t});const Hn=e=>({async oneTap(t,n,o,r){const i=null!=t?t:"google",a=await e.oauth.startNative(i,o);if(!a.ok)return a;const{clientId:s,stateId:c,nonce:l}=a.data,u=await async function(){return new Promise(((e,t)=>{if(window.google)return void e(window.google.accounts.id);let n=document.getElementById("google-gsi-client-script");n||(n=document.createElement("script"),document.head.appendChild(n),n.async=!0,n.defer=!0,n.id="google-gsi-client-script",n.src="https://accounts.google.com/gsi/client"),n.onload=function(){window.google?e(window.google.accounts.id):t("Failed to load Google GSI client script - not loaded properly")},n.onerror=function(){t("Failed to load Google GSI client script - failed to load")}}))}();return new Promise((t=>{var o,a;u.initialize(Object.assign(Object.assign({},n),{itp_support:null===(o=null==n?void 0:n.itp_support)||void 0===o||o,use_fedcm_for_prompt:null===(a=null==n?void 0:n.use_fedcm_for_prompt)||void 0===a||a,client_id:s,callback:n=>{t(e.oauth.finishNative(i,c,"","",n.credential))},nonce:l})),u.prompt((e=>{(null==e?void 0:e.isSkippedMoment())&&(null==r||r())}))}))}});var Bn=e=>Object.assign(Object.assign({},e.flow),{start:async(...t)=>{const n=await Ln(),o=Object.assign(Object.assign({location:window.location.href},t[1]),{deviceInfo:{webAuthnSupport:n},startOptionsVersion:1});return t[1]=o,e.flow.start(...t)}});const Fn=function(...e){return t=>e.reduce(((e,t)=>t(e)),t)}((t=>n=>{var{fpKey:o,fpLoad:r}=n,i=c(n,["fpKey","fpLoad"]);return tn?(o&&r&&wn(o).catch((()=>null)),t(e(i,{beforeRequest:mn}))):(console.warn("Fingerprint is a client side only capability and will not work when running in the server"),t(i))}),(n=>o=>{var{autoRefresh:r}=o,i=c(o,["autoRefresh"]);if(!r)return n(i);const{clearAllTimers:a,setTimer:s}=(()=>{const e=[];return{clearAllTimers:()=>{for(;e.length;)clearTimeout(e.pop())},setTimer:(t,n)=>{e.push(setTimeout(t,n))}}})();let l,u;document.addEventListener("visibilitychange",(()=>{"visible"===document.visibilityState&&new Date>l&&(en("Expiration time passed, refreshing session"),d.refresh(u))}));const d=n(e(i,{afterRequest:async(e,n)=>{const{refreshJwt:o,sessionJwt:r}=await t(n);if(401===(null==n?void 0:n.status))en("Received 401, canceling all timers"),a();else if(r){l=(e=>{const t=e.split(".");try{if(3===t.length){const e=JSON.parse(window.atob(t[1]));if(e.exp)return new Date(1e3*e.exp)}}catch(e){}return null})(r),u=o;let e=((i=l)?i.getTime()-(new Date).getTime():0)-2e4;e>nn&&(en(`Timeout is too large (${e}ms), setting it to ${nn}ms`),e=nn),a();const t=new Date(Date.now()+e).toLocaleTimeString("en-US",{hour12:!1});en(`Setting refresh timer for ${t}. (${e}ms)`),s((()=>{en("Refreshing session due to timer"),d.refresh(o)}),e)}var i}}));return He(d,["logout","logoutAll"],(e=>async(...t)=>{const n=await e(...t);return en("Clearing all timers"),a(),n}))}),(e=>t=>e(Object.assign(Object.assign({},t),{baseHeaders:Object.assign({"x-descope-sdk-name":"web-js","x-descope-sdk-version":"1.10.44"},t.baseHeaders)}))),(o=>r=>{const i=Sn(),a=Sn(),s=o(e(r,{afterRequest:async(e,o)=>{if(401===(null==o?void 0:o.status))i.pub(null),a.pub(null);else{const e=await n(o);e&&a.pub(e);const{sessionJwt:r}=await t(o);r&&i.pub(r)}}})),c=He(s,["logout","logoutAll"],(e=>async(...t)=>{const n=await e(...t);return i.pub(null),a.pub(null),n}));return Object.assign(c,{onSessionTokenChange:i.sub,onUserChange:a.sub})}),(t=>o=>{var{storeLastAuthenticatedUser:i=!0}=o,a=c(o,["storeLastAuthenticatedUser"]);if(!i)return Object.assign(t(a),{getLastUserLoginId:In,getLastUserDisplayName:kn});const s=t(e(a,{afterRequest:async(e,t)=>{var o;const i=await n(t),a=null===(o=null==i?void 0:i.loginIds)||void 0===o?void 0:o[0],s=null==i?void 0:i.name;a&&((e=>{r(bn,e)})(a),(e=>{r(yn,e)})(s))}}));let l=He(s,["flow.start"],On);return l=He(l,["logout","logoutAll"],jn),Object.assign(l,{getLastUserLoginId:In,getLastUserDisplayName:kn})}),(n=>o=>{var{persistTokens:a,sessionTokenViaCookie:s,storagePrefix:l}=o,u=c(o,["persistTokens","sessionTokenViaCookie","storagePrefix"]);if(!a||!tn)return a&&console.warn("Storing auth tokens in local storage and cookies are a client side only capabilities and will not be done when running in the server"),n(u);const d=n(e(u,{beforeRequest:(p=l,e=>Object.assign(e,{token:e.token||Tn(p)})),afterRequest:async(e,n)=>{const o=/^\/v\d+\/mgmt\//.test(e.path);401===(null==n?void 0:n.status)?o||An(l):((e={},t,n)=>{var{refreshJwt:o,sessionJwt:i}=e,a=c(e,["refreshJwt","sessionJwt"]);void 0===t&&(t=!1),void 0===n&&(n=""),o&&r(`${n}${En}`,o),i&&(t?xn(Pn,i,a):r(`${n}${Pn}`,i))})(await t(n),s,l)}}));var p;const g=He(d,["logout","logoutAll"],Cn(l));return Object.assign(g,{getRefreshToken:()=>Tn(l),getSessionToken:()=>function(e=""){return Rn.get(Pn)||i(`${e}${Pn}`)||""}(l)})}))(((...e)=>{const t=Wt(...e);return Object.assign(Object.assign({},t),{flow:Bn(t),webauthn:Vn(t),fedcm:Hn(t)})}));return Fn.REFRESH_TOKEN_KEY=En,Fn.SESSION_TOKEN_KEY=Pn,Fn}));
//# sourceMappingURL=index.umd.js.map
