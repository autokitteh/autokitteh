<!DOCTYPE html>
<head>
  <script src="https://unpkg.com/@descope/web-component@latest/dist/index.js"></script>
  <script src="https://unpkg.com/@descope/web-js-sdk@latest/dist/index.umd.js"></script>
  <script>
    const projectId = "{{.}}";
    const sdk = Descope({
      projectId: projectId,
      persistTokens: true,
      autoRefresh: true,
      sessionTokenViaCookie: true,
    });
  </script>
</head>
<html>
  <body>
    <h1>Log In With Descope Flows</h1>
    <p id="container" style="max-width: 500px"></p>

    <br />

    <script>
      const sessionToken = sdk.getSessionToken();
      let isTokenExpired = true;
      if (sessionToken) {
        isTokenExpired = sdk.isJwtExpired(sessionToken);
      }

      if (!sessionToken || isTokenExpired) {
        var container = document.getElementById("container");
        container.innerHTML =
          '<descope-wc project-id="' +
          projectId +
          '" flow-id="sign-up-or-in"></descope-wc>';
        const wcElement = document.getElementsByTagName("descope-wc")[0];
        const onSuccess = (e) => {
          console.log(e.detail.user);
          sdk.refresh();
          window.location.replace("/");
        };
        const onError = (err) => console.log(err);

        wcElement.addEventListener("success", onSuccess);
        wcElement.addEventListener("error", onError);
      } else {
        window.location.replace("/");
      }
    </script>
  </body>
</html>
