import{_ as T,d as _,e as k}from"./tslib-BsY54_Ss.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new n.Error().stack;o&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[o]="27ddc521-2711-40d3-94fe-aad8458b2f28",n._sentryDebugIdIdentifier="sentry-dbid-27ddc521-2711-40d3-94fe-aad8458b2f28")}catch{}})();function j(n,o){return function(t,c){return Object.prototype.hasOwnProperty.call(t,c)}(n,o)?n[o]:void 0}function A(n,o,t,c){var r,f=document,s="securitypolicyviolation",d=function(h){var i=new URL(n,location.href),e=h.blockedURI;e!==i.href&&e!==i.protocol.slice(0,-1)&&e!==i.origin||(r=h,p())};f.addEventListener(s,d);var p=function(){return f.removeEventListener(s,d)};return Promise.resolve().then(o).then(function(h){return p(),h},function(h){return new Promise(function(i){var e=new MessageChannel;e.port1.onmessage=function(){return i()},e.port2.postMessage(null)}).then(function(){if(p(),r)return t(r);throw h})})}var B={default:"endpoint"},P="Blocked by CSP",U="The endpoint parameter is not a valid URL",C="API key required",M="3.9.9",b="Failed to load the JS script of the agent",E="9319";function S(n,o){var t,c,r,f,s,d,p=[],h=(t=function(l){var u=k([],l,!0);return{current:function(){return u[0]},postpone:function(){var a=u.shift();a!==void 0&&u.push(a)},exclude:function(){u.shift()}}}(n),f=100,s=3e3,d=0,c=function(){return Math.random()*Math.min(s,f*Math.pow(2,d++))},r=new Set,[t.current(),function(l,u){var a,v=u instanceof Error?u.message:"";if(v===P||v===U)t.exclude(),a=0;else if(v===E)t.exclude();else if(v===b){var w=Date.now()-l.getTime()<50,y=t.current();y&&w&&!r.has(y)&&(r.add(y),a=0),t.postpone()}else t.postpone();var g=t.current();return g===void 0?void 0:[g,a??l.getTime()+c()-Date.now()]}]),i=h[0],e=h[1];if(i===void 0)return Promise.reject(new TypeError("The list of script URL patterns is empty"));var m=function(l){var u=new Date,a=function(w){return p.push({url:l,startedAt:u,finishedAt:new Date,error:w})},v=o(l);return v.then(function(){return a()},a),v.catch(function(w){if(p.length>=5)throw w;var y=e(u,w);if(!y)throw w;var g,I=y[0],L=y[1];return(g=L,new Promise(function(R){return setTimeout(R,g)})).then(function(){return m(I)})})};return m(i).then(function(l){return[l,p]})}var D="https://fpnpmcdn.net/v<version>/<apiKey>/loader_v<loaderVersion>.js",V=D;function F(n){var o;n.scriptUrlPattern;var t=n.token,c=n.apiKey,r=c===void 0?t:c,f=T(n,["scriptUrlPattern","token","apiKey"]),s=(o=j(n,"scriptUrlPattern"))!==null&&o!==void 0?o:D,d=function(){var i=[],e=function(){i.push({time:new Date,state:document.visibilityState})},m=function(l,u,a,v){return l.addEventListener(u,a,v),function(){return l.removeEventListener(u,a,v)}}(document,"visibilitychange",e);return e(),[i,m]}(),p=d[0],h=d[1];return Promise.resolve().then(function(){if(!r||typeof r!="string")throw new Error(C);var i=function(e,m){return(Array.isArray(e)?e:[e]).map(function(l){return function(u,a){var v=encodeURIComponent;return u.replace(/<[^<>]+>/g,function(w){return w==="<version>"?"3":w==="<apiKey>"?v(a):w==="<loaderVersion>"?v(M):w})}(String(l),m)})}(s,r);return S(i,K)}).catch(function(i){throw h(),function(e){return e instanceof Error&&e.message===E?new Error(b):e}(i)}).then(function(i){var e=i[0],m=i[1];return h(),e.load(_(_({},f),{ldi:{attempts:m,visibilityStates:p}}))})}function K(n){return A(n,function(){return function(o){return new Promise(function(t,c){if(function(d){if(URL.prototype)try{return new URL(d,location.href),!1}catch(p){if(p instanceof Error&&p.name==="TypeError")return!0;throw p}}(o))throw new Error(U);var r=document.createElement("script"),f=function(){var d;return(d=r.parentNode)===null||d===void 0?void 0:d.removeChild(r)},s=document.head||document.getElementsByTagName("head")[0];r.onload=function(){f(),t()},r.onerror=function(){f(),c(new Error(b))},r.async=!0,r.src=o,s.appendChild(r)})}(n)},function(){throw new Error(P)}).then(O)}function O(){var n=window,o="__fpjs_p_l_b",t=n[o];if(function(c,r){var f,s=(f=Object.getOwnPropertyDescriptor)===null||f===void 0?void 0:f.call(Object,c,r);s!=null&&s.configurable?delete c[r]:s&&!s.writable||(c[r]=void 0)}(n,o),typeof(t==null?void 0:t.load)!="function")throw new Error(E);return t}export{V as B,F,B as i};
